sudo: required
language: python

services:
  - docker

install:
  # https://github.com/openmicroscopy/ome-ansible-molecule-dependencies/pull/13
  - pip install https://github.com/openmicroscopy/ome-ansible-molecule-dependencies/archive/d5601fc60d2cae5fcf608cc045f6340ca7dd8c24.zip

script:
  # TODO: molecule will only run ansible-lint on the target playbook,
  # we should run it on all once they're compliant
  - >
    cd ansible &&
    ansible-lint -v *.yml
    --exclude ./roles/kubernetes/
    --exclude ./vendor/
    --exclude ../kubespray/
    --exclude idr-kubernetes-apply.yml
    --exclude idr-reset-users-groups.yml
  - cd ansible; molecule test
