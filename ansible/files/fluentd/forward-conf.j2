# Forward all logs labelled FORWARD to a central server
# https://docs.fluentd.org/v1.0/articles/out_forward
# TODO: Add multiple central servers for HA

<label @FORWARD>
  <match **>
    @type forward
    send_timeout 60s
    recover_wait 10s
    heartbeat_interval 1s
    phi_threshold 16
    hard_timeout 60s

    <server>
      name {{ fluentd_server_name }}
      host {{ fluentd_server_address }}
# I can't get this to work
#      shared_key {{ fluentd_shared_key }}
      port 24224
      weight 60
    </server>

    # Causes a warning: secondary type should be same with primary one
    <secondary>
      @type file
      path /var/log/td-agent/forward-failed.log
    </secondary>
  </match>
</label>
