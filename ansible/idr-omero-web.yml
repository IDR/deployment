# Install OMERO.web on the IDR

# TODO: Add omeroweb hosts group
- hosts: "{{ idr_environment | default('idr') }}-omero-hosts"

  roles:
  - role: ome.redis
  - role: ome.omero_web

  # Vars are in group_vars/omero-hosts.yml

  tasks:
  # TODO: https://github.com/ome/omero-web/pull/123
  - name: Patch OMERO.web so root / goes to gallery
    become: yes
    patch:
      basedir: "{{ omero_web_basedir }}/venv3/lib/python3.6/site-packages"
      # https://patch-diff.githubusercontent.com/raw/openmicroscopy/openmicroscopy/pull/6046.diff
      src: files/patches/pr6046-omeroweb-urls.patch
      strip: 1
    notify:
    - restart omero-web

  environment: "{{ idr_ANSIBLE_ENVIRONMENT_VARIABLES | default({}) }}"
