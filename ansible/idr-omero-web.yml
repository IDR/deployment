# Install OMERO.web on the IDR

# TODO: Add omeroweb hosts group
- hosts: "{{ idr_environment | default('idr') }}-omero-hosts"

  roles:
  - role: ome.redis
  - role: ome.omero_web

  # Vars are in group_vars/omero-hosts.yml

  environment: "{{ idr_ANSIBLE_ENVIRONMENT_VARIABLES | default({}) }}"

# This bloock will run in case of updating omero-web
# It will check for the ms user exists
# If so, it will run the role to update the omero web nginx configuration file

- hosts: "{{ idr_environment | default('idr') }}-omeroreadonly-hosts"
  become: true

  pre_tasks:
  - name: check if ms user exist
    ansible.builtin.user:
      name: "omero-server"
    check_mode: true
    register: service_user

  roles:
  - role: ome.omero_ms_image_region
    when: "{{ service_user.state | d('') == 'present' }}"

  environment: "{{ idr_ANSIBLE_ENVIRONMENT_VARIABLES | default({}) }}"
