---
# Delete VMs and security groups created by os-create.yml

- hosts: localhost
  connection: local
  gather_facts: false

  tasks:

    - fail: msg="omero_vm_name is required"
      when: omero_vm_name is undefined

    - name: Remove OMERO VM
      os_server:
        name: '{{ omero_vm_name }}'
        state: absent

    # Can't remove security group unless nothing is using it
    - name: Remove OMERO external access security group
      os_security_group:
        name: omero-external
        state: absent
