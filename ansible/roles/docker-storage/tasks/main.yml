---
# Setup LVM partitions for Docker

- name: storage | setup lvm docker-datadev
  lvol:
    vg: "{{ vgname }}"
    lv: docker-datadev
    size: "{{ docker.datasize }}"

- name: storage | setup lvm docker-metadatadev
  lvol:
    vg: "{{ vgname }}"
    lv: docker-metadatadev
    size: "{{ docker.metadatasize }}"

- name: storage | setup lvm docker-volume
  lvol:
    vg: "{{ vgname }}"
    lv: docker-volume
    size: "{{ docker.volumesize }}"

- name: storage | setup lvm scratch
  lvol:
    vg: "{{ vgname }}"
    lv: scratch
    size: "{{ scratchsize }}"

- name: storage | format
  filesystem:
    fstype: ext4
    dev: /dev/{{ vgname }}/{{ item }}
  with_items:
    - docker-volume
    - scratch

- name: storage | mount scratch
  mount:
    name: /scratch
    src: /dev/{{ vgname }}/scratch
    dump: 1
    passno: 2
    fstype: ext4
    state: mounted

- name: storage | mount docker-volume
  mount:
    name: /var/lib/docker
    src: /dev/{{ vgname }}/docker-volume
    dump: 1
    passno: 2
    fstype: ext4
    state: mounted
