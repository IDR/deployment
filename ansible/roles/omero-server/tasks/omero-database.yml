---
# Manage a local OMERO database
# This only works where the local system `postgres` user has admin rights

- fail:
    msg: "Only local OMERO databases with the standard postgres admin can be managed"
  when: omero_dbhost != "localhost"

- name: omero | create database
  become: yes
  become_user: postgres
  postgresql_db:
    encoding: UTF-8
    name: "{{ omero_dbname }}"
    state: present

- name: omero | create user
  become: yes
  become_user: postgres
  postgresql_user:
    db: "{{ omero_dbname }}"
    encrypted: yes
    name: "{{ omero_dbuser }}"
    password: "{{ omero_dbpassword }}"
    state: present
