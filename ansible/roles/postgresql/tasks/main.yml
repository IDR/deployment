---
# tasks file for roles/postgres

- name: postgres | setup repository
  become: yes
  yum:
    name: "{{ postgresql_repourl }}"
    state: present

- name: postgres | install client packages
  become: yes
  yum:
    name: "{{ postgresql_basename }}"
    state: present

- name: postgres | install server packages
  become: yes
  yum:
    name: "{{ postgresql_basename }}-server"
    state: present
  when: postgresql_install_server

- name: postgres | initialise data directory
  become: yes
  command: "{{ postgresql_bindir }}/{{ postgresql_basename }}-setup initdb"
  args:
    creates: "{{ postgresql_datadir }}/PG_VERSION"
  environment:
    PGSETUP_INITDB_OPTIONS: --encoding=UTF8 --locale=en_US.UTF-8 --auth-host=md5
  when: postgresql_install_server

- name: postgres | start service
  become: yes
  service:
    enabled: yes
    name: postgresql-{{ postgresql_version }}
    state: started
  when: postgresql_install_server
