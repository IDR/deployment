- name: texlive | prereq
  yum: name={{ item }} state=latest
  with_items:
    - perl-Tk
    - perl-Digest-MD5

- name: texlive | create the temp install folder
  file: path="{{ texlive_dest }}/tmp/" state=directory mode=0755
    

- name: texlive | download and extract installer
  unarchive:
    copy: no
    # Checking whether this version of texlive is installed
    # before downloading the installer.
    # Can the 'unarchive' test for a directory?
    creates: "{{ TEXDIR }}"
    dest: "{{ texlive_dest }}/tmp/"
    src: http://mirror.unl.edu/ctan/systems/texlive/tlnet/install-tl-unx.tar.gz

- name: texlive | rename the installer folder
  shell: mv install-tl-* install-tl-ansible
  args:
    chdir: "{{ texlive_dest }}/tmp/"
    creates: "{{ texlive_dest }}/tmp/install-tl-ansbile"

- name: texlive | copy profile
  copy: src=install-tl.profile dest=/tmp/install-tl.profile

# Install path variables to the install-tl.profile file rather than
# leaving them hard-coded in the profile file. This should be a foreach 
# and a list, if such a thing is possible...
- name: texlive | update profile file with install locations | TEXDIR
  replace: 
    regexp: '\$TEXDIR'
    replace: "{{ TEXDIR }}"
    dest: /tmp/install-tl.profile

- name: texlive | update profile file with install locations | TEXMFLOCAL 
  replace: 
    regexp: '\$TEXMFLOCAL'
    replace: "{{ TEXMFLOCAL }}"
    dest: /tmp/install-tl.profile

- name: texlive | update profile file with install locations | TEXMFSYSCONFIG
  replace: 
    regexp: '\$TEXMFSYSCONFIG'
    replace: "{{ TEXMFSYSCONFIG}}"
    dest: /tmp/install-tl.profile

- name: texlive | update profile file with install locations | TEXMFSYSVAR 
  replace: 
    regexp: '\$TEXMFSYSVAR'
    replace: "{{ TEXMFSYSVAR }}"
    dest: /tmp/install-tl.profile

- name: texlive | update profile file with install locations | TEXMFVAR
  replace: 
    regexp: '\$TEXMFVAR'
    replace: "{{ TEXMFVAR }}"
    dest: /tmp/install-tl.profile

- name: texlive | install texlive
  # clean up the whole temp dir at the end
  #command: rm /tmp/install-tl-unx.tar.gz removes=/tmp/install-tl-unx.tar.gz
  command: ./install-tl -profile /tmp/install-tl.profile
  args:
    chdir: "{{ texlive_dest }}/tmp/install-tl-ansible"

- name:  texlive | Symlink 
  file: 
    force: yes
    path: /etc/fonts/conf.d/09-texlive.conf
    src: "{{ TEXDIR }}/texmf-var/fonts/conf/texlive-fontconfig.conf"
    state: link

- name:  texlive | rebuild font cache
  command: fc-cache -rsfv
